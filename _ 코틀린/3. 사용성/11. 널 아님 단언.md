# 널 아님 단언 (!!)
#Kotlin/NullSafety

> [!INFO] 널 아님 단언(`!!`)이란?
> **널 아님 단언(Not-null Assertion)** 연산자 `!!`는 널이 될 수 있는(nullable) 타입의 변수를, 컴파일러에게 **"이 값은 절대로 `null`이 아니니, `null`이라고 생각하지 말고 그냥 사용해!"** 라고 강하게 단언하는 기능입니다.

`!!`를 사용하면, 널 가능한 타입의 변수를 널이 아닌(non-null) 타입처럼 즉시 사용할 수 있습니다.

## `!!` 연산자의 동작

-   **값이 `null`이 아닐 때**: 아무 일 없이 non-null 타입으로 변환되어, 프로퍼티나 함수에 정상적으로 접근합니다.
-   **값이 `null`일 때**: **`NullPointerException`(NPE)이 발생**하며 프로그램이 비정상적으로 종료됩니다.

```kotlin
fun main() {
    val name: String? = "Kotlin"
    println(name!!.length) // name이 null이 아니므로, 정상적으로 6을 출력

    val nullName: String? = null
    println(nullName!!.length) // 런타임 오류! NullPointerException 발생
}
```

## `!!`는 언제 사용해야 할까?

> [!WARNING] `!!`는 가능한 한 피해야 한다
> `!!` 연산자는 코틀린의 강력한 널 안정성(Null Safety) 시스템을 스스로 무너뜨리는 행위입니다. `!!`를 사용하는 것은 "나는 컴파일러보다 이 코드의 `null` 가능성을 더 잘 알고 있다"고 주장하는 것과 같으며, 만약 개발자의 생각이 틀렸을 경우 런타임에 NPE가 발생하게 됩니다.
>
> **`!!`를 사용하고 싶을 때는, 대부분의 경우 더 안전한 대안이 없는지 먼저 고민해야 합니다.**

### `!!`를 고려해볼 수 있는 경우

-   **다른 코드에서 `null`이 아님이 명백히 보장될 때**:
    예를 들어, 어떤 함수에 진입하는 시점에 특정 변수가 `null`이 아님을 이미 검사했고, 그 이후의 로직에서 해당 변수가 `null`로 변할 가능성이 전혀 없는 경우에 제한적으로 사용할 수 있습니다.

    ```kotlin
    fun process(user: User?) {
        if (user == null || user.name == null) {
            // 여기서 null 케이스를 모두 처리
            return
        }

        // 이 아래부터 user와 user.name은 절대 null이 아님이 보장됨
        // 이런 경우 !!를 사용하여 non-null 타입으로 다룰 수 있음
        println("Welcome, ${user.name!!}")
    }
    ```
    (하지만 이 경우에도 스마트 캐스트(Smart Cast)가 동작하여 `!!` 없이 `user.name`으로 접근 가능할 때가 많습니다.)

## `!!`의 더 안전한 대안

대부분의 경우, `!!`는 아래의 더 안전한 코틀린 기능으로 대체할 수 있습니다.

1.  **안전한 호출 (`?.`)**
    ```kotlin
    val length = name?.length // name이 null이면 null을 반환
    ```
2.  **엘비스 연산자 (`?:`)**
    ```kotlin
    val length = name?.length ?: 0 // name이 null이면 0을 반환
    ```
3.  **`let`과 같은 영역 함수**
    ```kotlin
    name?.let {
        // 이 블록 안에서는 it이 non-null 타입임이 보장됨
        println("The length is ${it.length}")
    }
    ```
4.  **명시적인 `if` 체크**
    ```kotlin
    if (name != null) {
        println("The length is ${name.length}")
    }
    ```

---
> [[00. 코틀린 목차.md|⬆️ 목차로 돌아가기]]
> [[10. 안전한 호출과 엘비스 연산자.md|⬅️ 이전: 안전한 호출과 엘비스 연산자]] | [[12. 확장 함수와 널이 될 수 있는 타입.md|➡️ 다음: 확장 함수와 널이 될 수 있는 타입]]