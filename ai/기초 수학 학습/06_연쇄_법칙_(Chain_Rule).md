# 06 연쇄 법칙 (Chain Rule): 합성함수 미분의 핵심 원리

## 1. 연쇄 법칙은 언제 사용할까요?

이전 학습에서 우리는 기본적인 함수들의 미분법을 배웠습니다. 하지만 함수들이 서로 결합된, 더 복잡한 형태라면 어떻게 해야 할까요? 예를 들어, $y = (2x + 1)^3$ 과 같은 함수를 생각해봅시다. 이 함수는 $g(x) = 2x + 1$ 이라는 함수와 $f(u) = u^3$ 이라는 함수가 합성된 $f(g(x))$ 형태입니다. 이렇게 **두 개 이상의 함수가 합성된 합성함수를 미분할 때 사용하는 핵심 기술이 바로 '연쇄 법칙(Chain Rule)'** 입니다.

연쇄 법칙은 이름 그대로, 미분이 연쇄적으로 일어나는 것을 의미합니다. 딥러닝에서 수많은 함수(활성화 함수)가 겹겹이 쌓여있는 신경망을 미분하여 학습하려면, 연쇄 법칙에 대한 이해는 필수적입니다.

## 2. 합성함수 다시 보기: 겉함수와 속함수

연쇄 법칙을 이해하려면 먼저 합성함수의 구조를 파악해야 합니다. 합성함수는 하나의 함수 안에 다른 함수가 들어있는 '마트료시카 인형'과 같습니다.

- **겉함수 (Outer function)**: 바깥쪽의 큰 인형. 위의 예시에서는 $f(u) = u^3$ 입니다.
- **속함수 (Inner function)**: 안쪽에 들어있는 작은 인형. 위의 예시에서는 $g(x) = 2x + 1$ 입니다.

연쇄 법칙의 핵심은 **"겉을 미분하고, 속을 미분해서 곱한다"** 입니다.

## 3. 연쇄 법칙의 공식

함수 $y = f(g(x))$ 를 미분하면 다음과 같습니다.

> $$y' = f'(g(x))g'(x)$$

말로 풀어쓰면 이렇습니다.

1.  **$f'(g(x))$**: 겉함수 $f$를 미분합니다. 이때 **속함수 $g(x)$는 그대로 둔 채로** 미분합니다.
2.  **$g'(x)$**: 속함수 $g(x)$를 미분합니다.
3.  **곱하기**: 위에서 구한 두 결과를 서로 곱합니다.

라이프니츠 표기법($\frac{dy}{dx}$)을 사용하면 연쇄 법칙을 더 직관적으로 이해할 수 있습니다.
$y = f(u)$ 이고 $u = g(x)$ 일 때,

> $$\frac{dy}{dx} = \frac{dy}{du} \cdot \frac{du}{dx}$$

$du$가 마치 분수처럼 약분되는 것처럼 보여서 공식을 기억하기 쉽습니다.

## 4. 예제로 익히는 연쇄 법칙

**예제 1: $y = (2x + 1)^3$**

1.  **겉함수와 속함수 파악**
    - 겉함수: $f(u) = u^3$
    - 속함수: $g(x) = 2x + 1$

2.  **각각 미분하기**
    - 겉함수 미분 $f'(u) = 3u^2$. 여기에 속함수를 그대로 넣으면 $f'(g(x)) = 3(2x+1)^2$
    - 속함수 미분 $g'(x) = 2$

3.  **두 결과 곱하기**
    - $y' = 3(2x+1)^2 \cdot 2 = 6(2x+1)^2$

**예제 2: $y = \sin(x^2)$**

1.  **겉함수와 속함수 파악**
    - 겉함수: $f(u) = \sin(u)$
    - 속함수: $g(x) = x^2$

2.  **각각 미분하기**
    - 겉함수 미분 $f'(u) = \cos(u)$. 여기에 속함수를 그대로 넣으면 $f'(g(x)) = \cos(x^2)$
    - 속함수 미분 $g'(x) = 2x$

3.  **두 결과 곱하기**
    - $y' = \cos(x^2) \cdot 2x = 2x \cos(x^2)$

## 5. 연쇄 법칙과 AI

딥러닝 모델은 입력 데이터가 여러 층(layer)을 거치면서 복잡한 함수 연산을 수행하는 구조입니다. 예를 들어 $y = f_3(f_2(f_1(x)))$ 와 같이 매우 깊은 합성함수 형태를 띱니다. 모델의 예측값과 실제값의 차이(오차)를 줄이기 위해 각 층의 파라미터를 조정해야 하는데, 이때 출력층에서부터 입력층까지 오차를 거꾸로 전파하며 각 파라미터에 대한 기울기를 계산합니다. 이 과정을 **'역전파(Backpropagation)'** 라고 부르며, 연쇄 법칙이 바로 이 역전파의 핵심 수학 원리입니다.

## 확인 문제

1.  합성함수 $y = (x^3 - 5x)^4$ 에서 겉함수와 속함수는 각각 무엇일까요?
2.  연쇄 법칙을 이용하여 $y = (x^3 - 5x)^4$ 의 도함수 $y'$를 구해보세요.
3.  $y = \cos(3x+2)$ 의 도함수를 구해보세요. (힌트: $\cos(x)$의 미분은 $-\sin(x)$ 입니다.)

---

*연쇄 법칙은 미분의 꽃이라고 할 수 있을 만큼 중요하고 활용도가 높습니다. 다양한 예제를 통해 "겉미분 * 속미분"의 감각을 익히는 것이 중요합니다. 질문이 있다면 주저하지 말고 물어보세요.*