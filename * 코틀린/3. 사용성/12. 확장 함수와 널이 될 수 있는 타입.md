# 확장 함수와 널 가능 타입
#Kotlin/Extension #Kotlin/NullSafety

> [!INFO]
> 코틀린의 확장 함수는 **널이 될 수 있는(nullable) 타입**에 대해서도 정의할 수 있습니다. 이는 `null` 체크와 관련된 반복적인 코드를 캡슐화하여, 더 깔끔하고 안전한 코드를 작성하는 데 매우 유용합니다.

## 1. 널 가능한 타입에 확장 함수 정의하기

-   확장하려는 타입 뒤에 물음표(`?`)를 붙여서 선언합니다. (`ReceiverType?`)
-   함수 내부에서 `this`는 `null`일 수 있으므로, `this`에 대한 `null` 체크가 필요합니다.

### 예시: `isNullOrBlank()` 직접 구현하기

코틀린 표준 라이브러리에 이미 포함된 `isNullOrBlank()` 함수는 바로 이런 방식으로 구현되어 있습니다.

```kotlin
// String? 타입에 대한 확장 함수 정의
fun String?.isNullOrBlank(): Boolean {
    // 함수 내부에서 'this'는 null일 수 있음
    return this == null || this.isBlank()
}

fun main() {
    val str1: String? = "Kotlin"
    val str2: String? = ""
    val str3: String? = null

    println(str1.isNullOrBlank()) // 출력: false
    println(str2.isNullOrBlank()) // 출력: true
    println(str3.isNullOrBlank()) // 출력: true
}
```
`this`가 `null`인 경우, `this == null`이 `true`가 되어 `this.isBlank()`는 호출되지 않으므로 NPE가 발생하지 않습니다.

## 2. 안전한 호출(`?.`)과 함께 사용

확장 함수 내부에서 안전한 호출(`?.`)과 엘비스 연산자(`?:`)를 조합하면, `null` 처리를 위한 유틸리티 함수를 쉽게 만들 수 있습니다.

```kotlin
// 널 가능한 String을 대문자로 바꾸거나, null이면 기본값을 반환하는 확장 함수
fun String?.toUpperCaseOrDefault(default: String): String {
    return this?.uppercase() ?: default
}

fun main() {
    val name: String? = "Alice"
    val nullName: String? = null

    println(name.toUpperCaseOrDefault("Unknown"))     // 출력: ALICE
    println(nullName.toUpperCaseOrDefault("Unknown")) // 출력: Unknown
}
```

## 3. 컬렉션과 함께 활용

널 가능한 원소를 포함하는 컬렉션에 대해, `null`을 안전하게 처리하는 확장 함수를 정의하여 코드의 가독성을 높일 수 있습니다.

```kotlin
// 널 가능한 String 리스트에서, null을 제외하고 모두 대문자로 변환하는 확장 함수
fun List<String?>.filterNotNullAndUppercase(): List<String> {
    val result = mutableListOf<String>()
    for (item in this) {
        item?.let { // item이 null이 아닐 때만 실행
            result.add(it.uppercase())
        }
    }
    return result
}

// 표준 라이브러리 함수를 사용하면 더 간결해짐
fun List<String?>.filterNotNullAndUppercaseConcise(): List<String> {
    return this.filterNotNull().map { it.uppercase() }
}

fun main() {
    val list = listOf("hello", null, "world", "")
    println(list.filterNotNullAndUppercase()) // 출력: [HELLO, WORLD, ]
}
```

---
> [[00. 코틀린 목차.md|⬆️ 목차로 돌아가기]]
> [[11. 널 아님 단언.md|⬅️ 이전: 널 아님 단언]] | [[13. 제네릭스 소개.md|➡️ 다음: 제네릭스 소개]]