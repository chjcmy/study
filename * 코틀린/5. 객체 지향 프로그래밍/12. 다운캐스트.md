# 타입 캐스팅: 스마트 캐스트와 as
#Kotlin/ObjectOriented

> [!INFO] 타입 캐스팅이란?
> **타입 캐스팅(Type Casting)**은 특정 타입의 변수를 다른 타입으로 변환하는 과정입니다. 코틀린에서는 상속 관계에 있는 클래스 간에 타입 변환이 자주 일어납니다.
> - **업캐스트(Upcasting)**: 자식 클래스 타입의 객체를 부모 클래스 타입으로 변환하는 것. (항상 안전하며, 묵시적으로 일어남)
> - **다운캐스트(Downcasting)**: 업캐스트된 객체를 다시 원래의 자식 클래스 타입으로 변환하는 것. (실패할 가능성이 있어 명시적으로 처리해야 함)

## 1. 스마트 캐스트 (Smart Casts)

> [!IMPORTANT]
> 코틀린의 **스마트 캐스트**는 컴파일러가 코드의 문맥을 파악하여, 특정 조건 하에서 변수의 타입을 **자동으로 캐스팅**해주는 매우 편리하고 안전한 기능입니다.

`is` 키워드로 타입을 확인하면, 해당 코드 블록 안에서는 개발자가 별도의 캐스팅을 하지 않아도 컴파일러가 알아서 타입을 변환해 줍니다.

```kotlin
open class Animal
class Dog : Animal() {
    fun bark() = "Woof!"
}
class Cat : Animal() {
    fun meow() = "Meow~"
}

fun makeSound(animal: Animal) {
    if (animal is Dog) {
        // 이 블록 안에서 animal은 Dog 타입으로 스마트 캐스트됨
        println(animal.bark())
    } else if (animal is Cat) {
        // 이 블록 안에서 animal은 Cat 타입으로 스마트 캐스트됨
        println(animal.meow())
    }
}

fun main() {
    makeSound(Dog()) // 출력: Woof!
    makeSound(Cat()) // 출력: Meow~
}
```
> 스마트 캐스트는 `val`로 선언되었거나, 타입 검사 이후 값이 변경되지 않음이 보장되는 `var` 변수에 대해서만 동작합니다.

## 2. 명시적 다운캐스트: `as` 와 `as?`

스마트 캐스트를 사용할 수 없는 상황에서는 `as` 또는 `as?` 연산자를 사용하여 명시적으로 타입을 변환해야 합니다.

### `as`: 안전하지 않은 캐스트 (Unsafe Cast)

-   객체를 특정 타입으로 강제 변환합니다.
-   만약 변환하려는 타입과 실제 객체의 타입이 호환되지 않으면, 런타임에 **`ClassCastException`이 발생**합니다.
-   따라서, 해당 타입임이 100% 확실한 경우에만 사용해야 합니다.

```kotlin
val animal: Animal = Dog()

// animal이 Dog 타입임을 확신하므로 as로 강제 캐스팅
val dog = animal as Dog
dog.bark()

val cat: Animal = Cat()
// val anotherDog = cat as Dog // 런타임 오류! ClassCastException 발생
```

### `as?`: 안전한 캐스트 (Safe Cast)

-   객체를 특정 타입으로 변환하려고 시도하고, 실패할 경우 **예외를 던지는 대신 `null`을 반환**합니다.
-   `as?` 연산자의 결과는 항상 널 가능한(nullable) 타입입니다.

```kotlin
val animal: Animal = Cat()

// animal을 Dog 타입으로 캐스팅 시도, 실패 시 null 반환
val dog: Dog? = animal as? Dog

if (dog != null) {
    dog.bark()
} else {
    println("Casting to Dog failed. It's not a Dog.")
}
// 출력: Casting to Dog failed. It's not a Dog.
```

> [!TIP]
> 예측 불가능한 오류를 방지하기 위해, `as`를 사용한 강제 캐스팅보다는 **`is`를 사용한 스마트 캐스트**나 **`as?`를 사용한 안전한 캐스트**를 우선적으로 사용하는 것이 좋습니다.

---
> [[00. 코틀린 목차.md|⬆️ 목차로 돌아가기]]
> [[11. 클래스 위임.md|⬅️ 이전: 클래스 위임]] | [[13. 봉인된 클래스.md|➡️ 다음: 봉인된 클래스]]