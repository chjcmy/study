# ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì„± ë° ì—°ê²°

## ğŸ—„ï¸ MongoDB ì„¤ì •

### ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
```bash
# MongoDB ì—°ê²°
mongosh --host 192.168.0.111:27017 --username recipe_admin --password 'RecipeDB_2024_Secure#9x7!' --authenticationDatabase admin

# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ë° ì‚¬ìš©ì ê¶Œí•œ ì„¤ì •
use recipe_ai_db
db.createUser({
  user: "recipe_admin",
  pwd: "RecipeDB_2024_Secure#9x7!",
  roles: [
    { role: "readWrite", db: "recipe_ai_db" },
    { role: "dbAdmin", db: "recipe_ai_db" }
  ]
})
```

### ì»¬ë ‰ì…˜ ë° ì¸ë±ìŠ¤ ìƒì„±
```javascript
// Users ì»¬ë ‰ì…˜ ì¸ë±ìŠ¤
db.users.createIndex({ "email": 1 }, { unique: true })
db.users.createIndex({ "username": 1 }, { unique: true })

// Recipes ì»¬ë ‰ì…˜ ì¸ë±ìŠ¤
db.recipes.createIndex({ "id": 1 }, { unique: true })
db.recipes.createIndex({ "name": "text", "description": "text", "ingredients": "text" })
db.recipes.createIndex({ "category": 1 })
db.recipes.createIndex({ "difficulty": 1 })

// Ingredients ì»¬ë ‰ì…˜ ì¸ë±ìŠ¤
db.ingredients.createIndex({ "ingredient_name": "text" })

// Vector Metadata ì»¬ë ‰ì…˜ ì¸ë±ìŠ¤
db.vectormetadatas.createIndex({ "vectorId": 1 }, { unique: true })
db.vectormetadatas.createIndex({ "recipe_id": 1 })

// Chat History ì»¬ë ‰ì…˜ ì¸ë±ìŠ¤
db.chathistories.createIndex({ "user": 1 })
db.chathistories.createIndex({ "createdAt": -1 })
```

## ğŸ” Elasticsearch ì„¤ì •

### ì¸ë±ìŠ¤ ë§¤í•‘ êµ¬ì„±

#### ë ˆì‹œí”¼ ì¸ë±ìŠ¤ (recipe-ai-recipes)
```json
{
  "mappings": {
    "properties": {
      "id": { "type": "integer" },
      "name": { "type": "text", "analyzer": "standard" },
      "description": { "type": "text", "analyzer": "standard" },
      "ingredients": { "type": "text", "analyzer": "standard" },
      "steps": { "type": "text", "analyzer": "standard" },
      "tags": { "type": "keyword" },
      "category": { "type": "keyword" },
      "difficulty": { "type": "keyword" },
      "minutes": { "type": "integer" },
      "n_ingredients": { "type": "integer" },
      "n_steps": { "type": "integer" },
      "rating": { "type": "float" },
      "allergyInfo": {
        "properties": {
          "ê¸€ë£¨í…í•¨ìœ ê³¡ë¬¼": { "type": "integer" },
          "ê°‘ê°ë¥˜": { "type": "integer" },
          "ë‚œë¥˜": { "type": "integer" },
          "ì–´ë¥˜": { "type": "integer" },
          "ë•…ì½©": { "type": "integer" },
          "ëŒ€ë‘": { "type": "integer" },
          "ìš°ìœ ": { "type": "integer" },
          "ê²¬ê³¼ë¥˜": { "type": "integer" },
          "ì…€ëŸ¬ë¦¬": { "type": "integer" },
          "ê²¨ì": { "type": "integer" },
          "ì°¸ê¹¨": { "type": "integer" },
          "ì•„í™©ì‚°ë¥˜": { "type": "integer" },
          "ë£¨í•€": { "type": "integer" },
          "ì—°ì²´ë™ë¬¼": { "type": "integer" },
          "ë³µìˆ­ì•„": { "type": "integer" },
          "í† ë§ˆí† ": { "type": "integer" },
          "ë¼ì§€ê³ ê¸°": { "type": "integer" },
          "ì‡ ê³ ê¸°": { "type": "integer" },
          "ë‹­ê³ ê¸°": { "type": "integer" }
        }
      }
    }
  },
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0,
    "analysis": {
      "analyzer": {
        "korean_analyzer": {
          "type": "standard",
          "stopwords": "_korean_"
        }
      }
    }
  }
}
```

#### ì¬ë£Œ ì¸ë±ìŠ¤ (recipe-ai-ingredients)
```json
{
  "mappings": {
    "properties": {
      "ingredient_name": { "type": "text", "analyzer": "standard" },
      "ê¸€ë£¨í…í•¨ìœ ê³¡ë¬¼": { "type": "integer" },
      "ê°‘ê°ë¥˜": { "type": "integer" },
      "ë‚œë¥˜": { "type": "integer" },
      "ì–´ë¥˜": { "type": "integer" },
      "ë•…ì½©": { "type": "integer" },
      "ëŒ€ë‘": { "type": "integer" },
      "ìš°ìœ ": { "type": "integer" },
      "ê²¬ê³¼ë¥˜": { "type": "integer" },
      "ì…€ëŸ¬ë¦¬": { "type": "integer" },
      "ê²¨ì": { "type": "integer" },
      "ì°¸ê¹¨": { "type": "integer" },
      "ì•„í™©ì‚°ë¥˜": { "type": "integer" },
      "ë£¨í•€": { "type": "integer" },
      "ì—°ì²´ë™ë¬¼": { "type": "integer" },
      "ë³µìˆ­ì•„": { "type": "integer" },
      "í† ë§ˆí† ": { "type": "integer" },
      "ë¼ì§€ê³ ê¸°": { "type": "integer" },
      "ì‡ ê³ ê¸°": { "type": "integer" },
      "ë‹­ê³ ê¸°": { "type": "integer" },
      "note": { "type": "text" }
    }
  },
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0
  }
}
```

#### ë²¡í„° ê²€ìƒ‰ ì¸ë±ìŠ¤ (recipe_vectors)
```json
{
  "mappings": {
    "properties": {
      "recipe_id": { "type": "keyword" },
      "embedding": {
        "type": "dense_vector",
        "dims": 1536
      },
      "text_content": { "type": "text" }
    }
  }
}
```

## ğŸ”´ Redis ì„¤ì •

### ì—°ê²° êµ¬ì„±
```typescript
// Redis í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
const redisClient = createClient({
  socket: {
    host: '192.168.0.111',
    port: 6379
  },
  password: 'RecipeAI2024!'
});
```

### ì‚¬ìš© ìš©ë„
- **ì„¸ì…˜ ìºì‹±**: ì‚¬ìš©ì ì¸ì¦ ì„¸ì…˜
- **ê²€ìƒ‰ ìºì‹±**: ìì£¼ ê²€ìƒ‰ë˜ëŠ” ì¿¼ë¦¬ ê²°ê³¼
- **ì„ì‹œ ë°ì´í„°**: ë²¡í„° ê³„ì‚° ê²°ê³¼
- **Rate Limiting**: API í˜¸ì¶œ ì œí•œ

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### Recipe Schema
```typescript
{
  name: string;              // ë ˆì‹œí”¼ ì´ë¦„
  id: number;               // ê³ ìœ  ID
  minutes: number;          // ì¡°ë¦¬ ì‹œê°„
  contributor_id: number;   // ê¸°ì—¬ì ID
  submitted: string;        // ì œì¶œì¼
  tags: string[];          // íƒœê·¸ ë°°ì—´
  nutrition: number[];     // ì˜ì–‘ ì •ë³´
  n_steps: number;         // ì¡°ë¦¬ ë‹¨ê³„ ìˆ˜
  steps: string[];         // ì¡°ë¦¬ ë‹¨ê³„
  description: string;     // ì„¤ëª…
  ingredients: string[];   // ì¬ë£Œ ëª©ë¡
  n_ingredients: number;   // ì¬ë£Œ ìˆ˜
  category: string;        // ì¹´í…Œê³ ë¦¬
  difficulty: string;      // ë‚œì´ë„
  rating: number;          // í‰ì 
  allergyInfo: object;     // ì•Œë ˆë¥´ê¸° ì •ë³´
}
```

### Ingredient Schema
```typescript
{
  ingredient_name: string;  // ì¬ë£Œëª…
  ê¸€ë£¨í…í•¨ìœ ê³¡ë¬¼: number;     // 0 ë˜ëŠ” 1
  ê°‘ê°ë¥˜: number;           // 0 ë˜ëŠ” 1
  ë‚œë¥˜: number;             // 0 ë˜ëŠ” 1
  ì–´ë¥˜: number;             // 0 ë˜ëŠ” 1
  ë•…ì½©: number;             // 0 ë˜ëŠ” 1
  ëŒ€ë‘: number;             // 0 ë˜ëŠ” 1
  ìš°ìœ : number;             // 0 ë˜ëŠ” 1
  ê²¬ê³¼ë¥˜: number;           // 0 ë˜ëŠ” 1
  ì…€ëŸ¬ë¦¬: number;           // 0 ë˜ëŠ” 1
  ê²¨ì: number;             // 0 ë˜ëŠ” 1
  ì°¸ê¹¨: number;             // 0 ë˜ëŠ” 1
  ì•„í™©ì‚°ë¥˜: number;         // 0 ë˜ëŠ” 1
  ë£¨í•€: number;             // 0 ë˜ëŠ” 1
  ì—°ì²´ë™ë¬¼: number;         // 0 ë˜ëŠ” 1
  ë³µìˆ­ì•„: number;           // 0 ë˜ëŠ” 1
  í† ë§ˆí† : number;           // 0 ë˜ëŠ” 1
  ë¼ì§€ê³ ê¸°: number;         // 0 ë˜ëŠ” 1
  ì‡ ê³ ê¸°: number;           // 0 ë˜ëŠ” 1
  ë‹­ê³ ê¸°: number;           // 0 ë˜ëŠ” 1
  note: string;            // ë¶€ê°€ ì„¤ëª…
}
```

## ğŸ”— ì—°ê²° ìƒíƒœ í™•ì¸

### í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
```bash
curl http://localhost:3001/api/v1/health
```

### ì‘ë‹µ ì˜ˆì‹œ
```json
{
  "status": "ok",
  "timestamp": "2025-06-11T12:00:00.000Z",
  "uptime": 3600,
  "checks": {
    "mongodb": "connected",
    "elasticsearch": "connected", 
    "redis": "connected"
  }
}
```

---
*ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ ì •ìƒì ìœ¼ë¡œ êµ¬ì„±ë˜ë©´ ë‹¤ìŒ ë‹¨ê³„ì¸ API ê°œë°œì„ ì§„í–‰*