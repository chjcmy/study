# SQL WITH 절 (CTE)
#Database/SQL #SQL/Advanced

> [!INFO]
> 이 문서는 기본 SQL을 넘어, 복잡한 데이터 분석과 조작을 가능하게 하는 고급 SQL 기능들을 다룹니다. CTE, 윈도우 함수, 고급 조인 및 서브쿼리, 트랜잭션 제어 등을 포함합니다.

## 1. WITH 절 (Common Table Expression, CTE)

> [!NOTE] CTE
> 복잡한 쿼리를 논리적인 단위로 나누어 가독성을 높이고 재사용하기 위한 이름 있는 임시 결과 집합입니다.

-   **기본 구문**
    ```sql
    WITH high_performers AS (
        SELECT name, grade FROM students WHERE grade > 4.0
    )
    SELECT * FROM high_performers WHERE name LIKE '김%';
    ```
-   **재귀 CTE (Recursive CTE)**: 계층 구조 데이터를 쿼리할 때 사용합니다.
    ```sql
    WITH RECURSIVE employee_hierarchy AS (
        -- 1. 시작점 (Anchor Member)
        SELECT id, name, manager_id, 1 as level FROM employees WHERE manager_id IS NULL
        UNION ALL
        -- 2. 재귀 부분 (Recursive Member)
        SELECT e.id, e.name, e.manager_id, eh.level + 1
        FROM employees e
        INNER JOIN employee_hierarchy eh ON e.manager_id = eh.id
    )
    SELECT * FROM employee_hierarchy;
    ```

---
> [[00. 데이터베이스 목차.md|⬆️ 목차로 돌아가기]]
> [[1-8. 서브쿼리.md|⬅️ 이전: 서브쿼리]] | [[2-2. 윈도우 함수.md|➡️ 다음: 윈도우 함수]]