# 정규화 vs 비정규화

---

## 정규화 (Normalization)

### 정규화 목적

```
데이터 중복을 제거하여 무결성을 보장

정규화 안 한 테이블 (주문 내역):
┌──────┬────┬──────────┬───────┬────────┐
│order │user│ product  │ price │ addr   │
├──────┼────┼──────────┼───────┼────────┤
│ 101  │ A  │ 노트북   │ 100만 │ 서울   │
│ 102  │ A  │ 마우스   │ 5만   │ 서울   │  ← "서울" 중복! 주소 바뀌면 다 고쳐야 함
│ 103  │ B  │ 키보드   │ 15만  │ 부산   │
└──────┴────┴──────────┴───────┴────────┘

문제(이상 현상):
  1. 삽입 이상: 주문이 없으면 사용자 등록 불가
  2. 수정 이상: 주소 변경 시 모든 주문 내역 수정 필요
  3. 삭제 이상: 주문 취소 시 사용자 정보도 삭제됨
```

### 정규화 단계

```
제1정규형 (1NF): 원자값 보장
  하나의 셀에 하나의 값만 ("A, B" 처럼 콤마로 넣지 말 것)

제2정규형 (2NF): 부분 종속 제거
  PK의 일부에만 종속되는 컬럼 분리 (복합키 사용 시)

제3정규형 (3NF): 이행 종속 제거
  A → B → C 관계일 때, A → C 직접 종속 제거
  주문 → 사용자 → 사용자주소 (사용자 주소는 사용자에 의존하도록 분리)

정규화 결과:
Users (id, name, address)
Products (id, name, price)
Orders (id, user_id, product_id, date)
```

### JOIN 사용

```sql
SELECT u.name, p.name
FROM Orders o
JOIN Users u ON o.user_id = u.id
JOIN Products p ON o.product_id = p.id
WHERE o.id = 101;
```

---

## 비정규화 (Denormalization)

### NoSQL / 조회 성능 최적화

```json
// MongoDB 예시: 주문 문서에 사용자/상품 정보 일부를 포함 (Embedding)
{
    "_id": 101,
    "date": "2024-02-19",
    "user": {
        "id": "A",
        "name": "홍길동",
        "address": "서울"  // 중복 저장!
    },
    "items": [
        { "product_id": "P1", "name": "노트북", "price": 1000000 }
    ]
}

// 장점: JOIN 없이 1번의 읽기로 주문서 출력 가능 (읽기 성능 극대화)
// 단점: 사용자가 주소를 바꾸면? → 과거 주문내역의 주소는 그대로 둠 
//       (오히려 이게 비즈니스 로직에 맞을 수도 있음!)
```

### 언제 비정규화(역정규화) 하는가?

1.  **과도한 JOIN으로 조회 성능이 느릴 때**
2.  **분석용 데이터 (Data Warehouse)**: 미리 합쳐둠
3.  **이력 관리**: 가격이 변해도 주문 당시 가격을 유지해야 할 때
4.  **NoSQL 사용 시**: Document 모델 특성상

---

## 비교 정리

| 기준 | 정규화 (SQL) | 비정규화 (NoSQL/튜닝) |
|------|------------|----------------|
| **중복** | **최소** | 허용 |
| **무결성** | **보장** | 앱 레벨 관리 필요 |
| **읽기 속도** | JOIN으로 느릴 수 있음 | **매우 빠름** (Local) |
| **쓰기 속도** | 빠름 (한 곳만 수정) | 느릴 수 있음 (여러 곳 수정) |
| **저장 공간** | 효율적 | 더 많이 차지 |

---

## 면접 핵심 포인트

```
Q: 정규화를 하는 이유?
A: 데이터 중복을 제거하여 이상 현상(삽입/삭제/수정 이상)을 방지하고 무결성을 유지하기 위함.

Q: 반대로 비정규화(역정규화)는 언제 하나?
A: JOIN이 너무 많아 조회 성능이 저하될 때, 읽기 성능을 높이기 위해 의도적으로 중복을 허용함.
   또는 주문 당시의 가격/주소 정보를 보존해야 하는 경우에도 사용.

Q: 제3정규형(3NF)이란?
A: 이행적 함수 종속을 제거하는 것. A->B, B->C 일 때 A->C가 되는 관계를 분리하여,
   비주요 속성이 기본키에만 의존하게 만드는 것.
```
