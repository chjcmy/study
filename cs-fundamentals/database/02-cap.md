# CAP 이론 & PACELC

---

## CAP 이론

```
분산 시스템에서 3가지를 동시에 모두 만족할 수는 없다. (2가지만 선택 가능)

1. Consistency (일관성)
   모든 노드가 같은 시간에 같은 데이터를 보여줌
   (쓰기 직후 읽으면 항상 최신 데이터)

2. Availability (가용성)
   모든 요청에 대해 (에러 없이) 응답을 받음
   (일부 노드가 죽어도 시스템은 동작)

3. Partition Tolerance (분할 내성) ⭐ 필수!
   네트워크 단절로 노드 간 통신이 끊겨도 시스템이 동작
```

### 현실적인 선택

네트워크 분할(P)은 인터넷 환경에서 언제든 발생하므로, 결국 **CP vs AP**의 선택!

*   **CP (일관성 + 분할 내성):**
    *   네트워크 끊기면? → 데이터 불일치 막기 위해 **일부 요청 거부** (가용성 포기)
    *   예: 은행 계좌, 결제 시스템, MongoDB(기본), HBase
    *   "틀린 답을 주느니 아예 안 주겠다"

*   **AP (가용성 + 분할 내성):**
    *   네트워크 끊기면? → 일단 **과거 데이터라도 응답** (일관성 포기)
    *   나중에 데이터 동기화 (Eventual Consistency)
    *   예: SNS 피드, 카산드라(Cassandra), 다이나모(Dynamo)
    *   "틀려도 좋으니 일단 답은 주겠다"

---

## PACELC 이론

```
CAP 이론의 한계(네트워크 장애 상황만 고려)를 보완.
"네트워크 장애가 없을 때(E: Else)"는 무엇을 희생할 것인가?

P (Partition) 발생 시:
  A (Availability) vs C (Consistency) 선택

E (Else - 정상 상황) 시:
  L (Latency - 지연시간) vs C (Consistency) 선택
```

### 설명

*   **PC/EC:** 장애 시 일관성(CP), 정상 시 일관성(데이터 검증하느라 느림) → **HBase, BigTable**
*   **PA/EL:** 장애 시 가용성(AP), 정상 시 지연시간 최소화(비동기 복제라 빠름) → **Cassandra, DynamoDB**

---

## 일관성 모델 (Consistency Models)

강한 일관성(Strong)에서 약한 일관성(Weak) 순서:

1.  **Strong Consistency (강한 일관성):**
    *   RDBMS 수준. 쓰자마자 바로 읽힘.
    *   성능 저하, 확장성 낮음.

2.  **Eventual Consistency (최종 일관성):**
    *   AP 시스템의 특징.
    *   "언젠가는" 동기화됨. (수 ms ~ 수 초 후)
    *   읽기/쓰기 매우 빠름.

---

## 면접 핵심 포인트

```
Q: CAP 이론에서 P를 포기할 수 없는 이유는?
A: 분산 시스템에서 네트워크 장애는 필연적이기 때문.
   따라서 P를 전제로 놓고, 장애 시 C(일관성)를 지킬지 A(가용성)를 지킬지 선택해야 함.

Q: MongoDB와 Cassandra의 차이를 CAP로 설명하면?
A: MongoDB는 기본적으로 CP 시스템 (Master 노드 장애 시 복구 동안 쓰기 불가).
   Cassandra는 AP 시스템 (어떤 노드에 써도 되며, 나중에 동기화).

Q: Eventual Consistency(최종 일관성)란?
A: 즉시 일관성을 보장하지 않지만, 시간이 지나면 결국 모든 노드가 같은 데이터를 갖게 되는 모델.
   SNS 좋아요, 조회수 등 실시간 정확성보다 가용성이 중요한 서비스에 적합.
```
