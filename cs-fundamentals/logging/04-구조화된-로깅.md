# êµ¬ì¡°í™”ëœ ë¡œê¹… (Structured Logging)

---

## 1. êµ¬ì¡°í™”ëœ ë¡œê¹…ì´ë€?

**êµ¬ì¡°í™”ëœ ë¡œê¹…(Structured Logging)** ì´ë€ ë¡œê·¸ ë°ì´í„°ë¥¼ **ì¼ê´€ëœ í˜•ì‹ì˜ í‚¤-ê°’ ìŒ**ìœ¼ë¡œ ê¸°ë¡í•˜ì—¬, ê¸°ê³„ê°€ ì‰½ê²Œ íŒŒì‹±Â·ê²€ìƒ‰Â·ì§‘ê³„í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë¡œê¹… ë°©ì‹ì´ë‹¤.

> í•µì‹¬ ì „í™˜: ë¡œê·¸ë¥¼ **"ì‚¬ëŒì´ ì½ëŠ” í…ìŠ¤íŠ¸"** ì—ì„œ **"ê¸°ê³„ê°€ ì²˜ë¦¬í•˜ëŠ” ë°ì´í„°"** ë¡œ ë°”ê¾¸ëŠ” ê²ƒ

---

## 2. ë¹„êµ¬ì¡°í™” vs ë°˜êµ¬ì¡°í™” vs êµ¬ì¡°í™”

ë¡œê·¸ í˜•ì‹ì˜ ì§„í™”ë¥¼ 3ë‹¨ê³„ë¡œ ì´í•´í•˜ì:

### 2.1 âŒ ë¹„êµ¬ì¡°í™” ë¡œê·¸ (Unstructured)

```
2026-02-24 18:30:00 ERROR User login failed for user@example.com from IP 203.0.113.42 after 3 attempts
```

**íŠ¹ì§•:** ììœ ë¡œìš´ í…ìŠ¤íŠ¸. ì‚¬ëŒì€ ì½ì„ ìˆ˜ ìˆì§€ë§Œ, ê¸°ê³„ëŠ” ì–´ë µë‹¤.

```
ë¬¸ì œì :
  â”œâ”€â”€ íŒŒì‹±: ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ì¶”ì¶œí•´ì•¼ í•¨ â†’ ë©”ì‹œì§€ í˜•ì‹ì´ ë°”ë€Œë©´ ê¹¨ì§
  â”œâ”€â”€ ê²€ìƒ‰: "user@example.comì˜ ì‹¤íŒ¨ë§Œ ë³´ê³  ì‹¶ë‹¤" â†’ grepìœ¼ë¡œ ë¶€ì •í™•í•˜ê²Œ ê²€ìƒ‰
  â”œâ”€â”€ ì§‘ê³„: "IPë³„ ë¡œê·¸ì¸ ì‹¤íŒ¨ íšŸìˆ˜" â†’ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§ì ‘ ì‘ì„±í•´ì•¼ í•¨
  â””â”€â”€ ì—°ë™: ë¡œê·¸ ë¶„ì„ ë„êµ¬ì— ë„£ìœ¼ë ¤ë©´ ë³„ë„ íŒŒì„œ ì„¤ì • í•„ìš”
```

### 2.2 ğŸŸ¡ ë°˜êµ¬ì¡°í™” ë¡œê·¸ (Semi-structured)

```
2026-02-24 18:30:00 ERROR [auth-service] [req-abc123] User login failed | user=user@example.com | ip=203.0.113.42 | attempts=3
```

**íŠ¹ì§•:** í…ìŠ¤íŠ¸ì´ì§€ë§Œ í‚¤-ê°’ íŒ¨í„´ì´ ìˆë‹¤. íŒŒì‹±ì€ ê°€ëŠ¥í•˜ì§€ë§Œ ì™„ë²½í•˜ì§€ ì•Šë‹¤.

### 2.3 âœ… êµ¬ì¡°í™” ë¡œê·¸ (Structured â€” JSON)

```json
{
  "timestamp": "2026-02-24T18:30:00.123+09:00",
  "level": "ERROR",
  "service": "auth-service",
  "request_id": "req-abc123",
  "event": "login_failed",
  "message": "User login failed after maximum attempts",
  "user_email": "user@example.com",
  "ip_address": "203.0.113.42",
  "attempt_count": 3,
  "max_attempts": 5,
  "failure_reason": "invalid_password",
  "trace_id": "trace-xyz-789"
}
```

**ì¥ì :**
- ğŸ” `jq '.user_email == "user@example.com"'` â†’ ì¦‰ì‹œ í•„í„°ë§
- ğŸ“Š `GROUP BY ip_address COUNT(*)` â†’ SQLì²˜ëŸ¼ ì§‘ê³„
- ğŸ”— ë¡œê·¸ ë¶„ì„ ë„êµ¬ê°€ ì„¤ì • ì—†ì´ ë°”ë¡œ íŒŒì‹±
- ğŸŒ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì˜ ë¡œê·¸ë¥¼ ë™ì¼ í¬ë§·ìœ¼ë¡œ í†µí•©

### ë¹„êµ ìš”ì•½

| ê´€ì  | ë¹„êµ¬ì¡°í™” | ë°˜êµ¬ì¡°í™” | êµ¬ì¡°í™” (JSON) |
|------|---------|---------|-------------|
| **ì‚¬ëŒ ê°€ë…ì„±** | âœ… ì¢‹ìŒ | ğŸŸ¡ ë³´í†µ | ğŸŸ¡ ë³´í†µ (ë„êµ¬ë¡œ ë³´ì™„) |
| **ê¸°ê³„ íŒŒì‹±** | âŒ ì–´ë ¤ì›€ | ğŸŸ¡ ê°€ëŠ¥ | âœ… ì¦‰ì‹œ ê°€ëŠ¥ |
| **ê²€ìƒ‰/í•„í„°ë§** | âŒ grep ì˜ì¡´ | ğŸŸ¡ ì œí•œì  | âœ… í•„ë“œë³„ ì •í™•í•œ ê²€ìƒ‰ |
| **ì§‘ê³„/ë¶„ì„** | âŒ ìŠ¤í¬ë¦½íŠ¸ í•„ìš” | ğŸŸ¡ ì œí•œì  | âœ… SQL-like ì¿¼ë¦¬ |
| **ë„êµ¬ ì—°ë™** | âŒ íŒŒì„œ í•„ìš” | ğŸŸ¡ ì œí•œì  | âœ… ì„¤ì • ë¶ˆí•„ìš” |
| **ì„œë¹„ìŠ¤ ê°„ ì¼ê´€ì„±** | âŒ í†µì¼ ì–´ë ¤ì›€ | ğŸŸ¡ ê°€ëŠ¥ | âœ… ìŠ¤í‚¤ë§ˆë¡œ ê°•ì œ |

---

## 3. êµ¬ì¡°í™” ë¡œê¹…ì˜ í•µì‹¬ ì›ì¹™

### ì›ì¹™ 1: ì¼ê´€ì„± (Consistency)

ëª¨ë“  ì„œë¹„ìŠ¤, ëª¨ë“  íŒ€ì´ **ë™ì¼í•œ í•„ë“œëª…ê³¼ í¬ë§·**ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```
âŒ ì„œë¹„ìŠ¤ë§ˆë‹¤ ë‹¤ë¥¸ í•„ë“œëª…:

  auth-service:     { "ts": "...", "userId": "U-123" }
  order-service:    { "timestamp": "...", "user_id": "U-123" }
  payment-service:  { "time": "...", "uid": "U-123" }

  â†’ 3ê°œ ì„œë¹„ìŠ¤ì—ì„œ ê°™ì€ ì‚¬ìš©ìë¥¼ ì¶”ì í•˜ë ¤ë©´
    ts, timestamp, timeì„ ëª¨ë‘ ì•Œì•„ì•¼ í•˜ê³ 
    userId, user_id, uidë¥¼ ëª¨ë‘ ê²€ìƒ‰í•´ì•¼ í•¨

âœ… í†µì¼ëœ í•„ë“œëª…:

  auth-service:     { "timestamp": "...", "user_id": "U-123" }
  order-service:    { "timestamp": "...", "user_id": "U-123" }
  payment-service:  { "timestamp": "...", "user_id": "U-123" }

  â†’ "user_id"ë¡œ ê²€ìƒ‰í•˜ë©´ ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ê²°ê³¼ê°€ ë‚˜ì˜´
```

### ì›ì¹™ 2: í’ë¶€í•œ ì»¨í…ìŠ¤íŠ¸ (Rich Context)

ë¡œê·¸ í•œ ì¤„ë§Œ ë³´ê³ ë„ **"ë¬´ìŠ¨ ìƒí™©ì¸ì§€"** íŒŒì•…í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

```
âŒ ì»¨í…ìŠ¤íŠ¸ ë¶€ì¡±:
  { "level": "ERROR", "message": "Connection timeout" }
  â†’ ì–´ë–¤ ì—°ê²°? ì–´ë””ì„œ? ì–´ë–¤ ìš”ì²­ ì²˜ë¦¬ ì¤‘ì—? ... ëª¨ë¦„

âœ… í’ë¶€í•œ ì»¨í…ìŠ¤íŠ¸:
  {
    "level": "ERROR",
    "message": "Connection timeout",
    "service": "payment-service",
    "target": "stripe-api.com:443",
    "timeout_ms": 30000,
    "retry_count": 3,
    "order_id": "ORD-123",
    "trace_id": "abc-xyz"
  }
  â†’ ê²°ì œ ì„œë¹„ìŠ¤ì—ì„œ Stripe API ì—°ê²°ì´ 30ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ, 3ë²ˆ ì¬ì‹œë„ ì‹¤íŒ¨
```

### ì›ì¹™ 3: ë¯¼ê° ì •ë³´ ì œì™¸ (No Sensitive Data)

```
ğŸš« ì ˆëŒ€ ë¡œê·¸ì— ë„£ì§€ ë§ ê²ƒ:

  ë¹„ë°€ë²ˆí˜¸     â†’ "password_provided": true (ì œê³µ ì—¬ë¶€ë§Œ)
  ì¹´ë“œë²ˆí˜¸     â†’ "card_last4": "5678" (ë§ˆì§€ë§‰ 4ìë¦¬ë§Œ)
  í† í°/í‚¤      â†’ "token_prefix": "eyJh..." (ì• 4ìë¦¬ë§Œ)
  ì£¼ë¯¼ë²ˆí˜¸     â†’ "has_ssn": true (ì¡´ì¬ ì—¬ë¶€ë§Œ)
  ê°œì¸ ì´ë©”ì¼   â†’ "email_domain": "gmail.com" (ë„ë©”ì¸ë§Œ, ë˜ëŠ” í•´ì‹œ)
```

> ì™œ? ë¡œê·¸ëŠ” ì—¬ëŸ¬ ì‹œìŠ¤í…œì— ë³µì œÂ·ì €ì¥ëœë‹¤. í•œë²ˆ ë¡œê·¸ì— ë‚¨ìœ¼ë©´ ëª¨ë“  ê³³ì— í¼ì§„ë‹¤.
> GDPR, ê°œì¸ì •ë³´ë³´í˜¸ë²• ìœ„ë°˜ ì‹œ ëŒ€ê·œëª¨ ë²Œê¸ˆ ê°€ëŠ¥.

### ì›ì¹™ 4: ì´ë²¤íŠ¸ ì¤‘ì‹¬ (Event-Oriented)

```
âŒ í–‰ë™ ì„œìˆ :
  { "message": "We are now going to check the user's cart and process the payment" }

âœ… ì´ë²¤íŠ¸ ê¸°ë¡:
  { "event": "payment_initiated", "order_id": "ORD-123", "amount": 55000 }
  { "event": "payment_completed", "order_id": "ORD-123", "payment_id": "PAY-456" }
```

---

## 4. í‘œì¤€ í•„ë“œ ì„¤ê³„

### 4.1 í•„ìˆ˜ í•„ë“œ (ëª¨ë“  ë¡œê·¸ì— í¬í•¨)

```json
{
  "timestamp": "2026-02-24T18:30:00.123+09:00",
  "level": "INFO",
  "service": "order-service",
  "environment": "production",
  "message": "ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ìš”ì•½"
}
```

| í•„ë“œ | íƒ€ì… | í˜•ì‹ | ì„¤ëª… |
|------|------|------|------|
| `timestamp` | string | ISO 8601 (`+ì‹œê°„ëŒ€`) | ì´ë²¤íŠ¸ ë°œìƒ ì‹œê° |
| `level` | string | TRACE~FATAL | ì‹¬ê°ë„ |
| `service` | string | ì†Œë¬¸ì-ì¼€ë°¥ | ì„œë¹„ìŠ¤ ì´ë¦„ |
| `environment` | string | production/staging/dev | í™˜ê²½ êµ¬ë¶„ |
| `message` | string | ììœ  í˜•ì‹ | ì‚¬ëŒì„ ìœ„í•œ ì„¤ëª… |

### 4.2 ì¶”ì  í•„ë“œ (ë¶„ì‚° ì‹œìŠ¤í…œ)

```json
{
  "trace_id": "4bf92f3577b34da6a3ce929d0e0e4736",
  "span_id": "00f067aa0ba902b7",
  "parent_span_id": "a1b2c3d4e5f6a7b8",
  "request_id": "req-abc-123"
}
```

| í•„ë“œ | ëª©ì  |
|------|------|
| `trace_id` | í•˜ë‚˜ì˜ ìš”ì²­ ì „ì²´ë¥¼ ì¶”ì  (ì„œë¹„ìŠ¤ ê°„ ê³µìœ ) |
| `span_id` | ìš”ì²­ ë‚´ ê°œë³„ ì‘ì—… ë‹¨ìœ„ |
| `parent_span_id` | ì´ ì‘ì—…ì˜ ìƒìœ„ ì‘ì—… |
| `request_id` | HTTP ìš”ì²­ ë‹¨ìœ„ ê³ ìœ  ID |

```
        trace_id = "abc123" (ì „ì²´ ìš”ì²­ì— ë™ì¼)
        â”‚
  API Gateway (span_id = "span-1")
        â”‚
  Auth Service (span_id = "span-2", parent = "span-1")
        â”‚
  Order Service (span_id = "span-3", parent = "span-1")
        â”‚
  DB Query (span_id = "span-4", parent = "span-3")
```

### 4.3 ì£¼ì²´ í•„ë“œ (ëˆ„ê°€ í–ˆëŠ”ê°€)

```json
{
  "user_id": "U-456",
  "session_id": "sess-abc123",
  "client_ip": "203.0.113.42",
  "user_agent": "MyApp/2.3 (iOS 19)"
}
```

### 4.4 ì´ë²¤íŠ¸ í•„ë“œ (ë¬´ì—‡ì´ ì¼ì–´ë‚¬ëŠ”ê°€)

```json
{
  "event": "order_created",
  "event_category": "business",
  "outcome": "success",
  "duration_ms": 245,
  "data": {
    "order_id": "ORD-789",
    "items_count": 3,
    "total_amount": 55000
  }
}
```

---

## 5. í‘œì¤€ ë¡œê·¸ ìŠ¤í‚¤ë§ˆ

ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì—ì„œ ì¼ê´€ëœ í¬ë§·ì„ ì“°ë ¤ë©´ **í‘œì¤€ ìŠ¤í‚¤ë§ˆ**ë¥¼ ì±„íƒí•œë‹¤.

### 5.1 ECS (Elastic Common Schema)

Elasticì‚¬ê°€ ë§Œë“  ì˜¤í”ˆì†ŒìŠ¤ ë¡œê·¸ ìŠ¤í‚¤ë§ˆ. Elasticsearch ìƒíƒœê³„ì— ìµœì í™”.

```json
{
  "@timestamp": "2026-02-24T18:30:00.123Z",
  "log.level": "error",
  "message": "Payment processing failed",
  "service.name": "payment-service",
  "service.version": "2.3.1",
  "service.environment": "production",
  "trace.id": "abc123",
  "span.id": "def456",
  "user.id": "U-789",
  "source.ip": "203.0.113.42",
  "event.action": "payment_failed",
  "event.outcome": "failure",
  "error.type": "GatewayTimeoutError",
  "error.message": "Stripe API timeout after 30s"
}
```

**íŠ¹ì§•:** ì (`.`) í‘œê¸°ë²•ìœ¼ë¡œ ê³„ì¸µ êµ¬ë¶„, 100ê°œ ì´ìƒì˜ í‘œì¤€ í•„ë“œì…‹ ì •ì˜

### 5.2 OpenTelemetry Log Data Model

CNCFì˜ ë²¤ë” ì¤‘ë¦½ í‘œì¤€. ë¡œê·¸Â·ë©”íŠ¸ë¦­Â·íŠ¸ë ˆì´ìŠ¤ 3ê°€ì§€ë¥¼ í•˜ë‚˜ë¡œ í†µí•©.

```json
{
  "Timestamp": "2026-02-24T18:30:00.123Z",
  "SeverityText": "ERROR",
  "SeverityNumber": 17,
  "Body": "Payment processing failed",
  "Resource": {
    "service.name": "payment-service",
    "service.version": "2.3.1",
    "deployment.environment": "production"
  },
  "Attributes": {
    "order_id": "ORD-123",
    "payment_gateway": "stripe",
    "error.type": "GatewayTimeoutError"
  },
  "TraceId": "4bf92f3577b34da6a3ce929d0e0e4736",
  "SpanId": "00f067aa0ba902b7"
}
```

**íŠ¹ì§•:** `Resource`(ì„œë¹„ìŠ¤ ì •ì²´ì„±)ì™€ `Attributes`(ì´ë²¤íŠ¸ë³„ ë°ì´í„°)ë¥¼ ë¶„ë¦¬

### ìŠ¤í‚¤ë§ˆ ë¹„êµ

| ê´€ì  | ECS | OpenTelemetry |
|------|-----|-------------|
| **ê´€ë¦¬ ì£¼ì²´** | Elasticì‚¬ | CNCF (ë²¤ë” ì¤‘ë¦½) |
| **ì£¼ìš” ìƒíƒœê³„** | ELK Stack | Jaeger, Grafana, ë“± ë‹¤ì–‘ |
| **í•„ë“œ í‘œê¸°** | `ì .í‘œê¸°ë²•` | `Resource` + `Attributes` ë¶„ë¦¬ |
| **íŠ¸ë ˆì´ì‹± í†µí•©** | ë³„ë„ ì—°ë™ í•„ìš” | âœ… ë„¤ì´í‹°ë¸Œ í†µí•© |
| **ì„±ìˆ™ë„** | ë†’ìŒ | ë¹ ë¥´ê²Œ ì„±ì¥ ì¤‘ |
| **ë¯¸ë˜ ë°©í–¥** | OTelê³¼ í†µí•© ì§„í–‰ ì¤‘ | ì—…ê³„ í‘œì¤€ ë  ì „ë§ |

> ğŸ“Œ ECSì™€ OpenTelemetry Semantic Conventionsì€ í˜„ì¬ **í†µí•© ì‘ì—…** ì¤‘ì´ë‹¤.
> ë¯¸ë˜ì—ëŠ” í•˜ë‚˜ì˜ í‘œì¤€ìœ¼ë¡œ ìˆ˜ë ´í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.

---

## 6. ì»¨í…ìŠ¤íŠ¸ ìë™ ì£¼ì…: MDC

### 6.1 MDC (Mapped Diagnostic Context)ë€?

ëª¨ë“  ë¡œê·¸ í˜¸ì¶œì— ìˆ˜ë™ìœ¼ë¡œ `user_id`, `request_id`ë¥¼ ë„£ëŠ” ê±´ ë¹„í˜„ì‹¤ì ì´ë‹¤:

```python
# âŒ ëª¨ë“  í•¨ìˆ˜ì— ì¼ì¼ì´ ì „ë‹¬í•´ì•¼ í•¨
def process_order(order, user_id, request_id):
    logger.info("Processing order", extra={"user_id": user_id, "request_id": request_id})
    validate(order, user_id, request_id)
    charge(order, user_id, request_id)
    ...

def validate(order, user_id, request_id):
    logger.info("Validating", extra={"user_id": user_id, "request_id": request_id})
    ...
```

**MDC**ëŠ” ì´ ë¬¸ì œë¥¼ í•´ê²°í•œë‹¤: **ìŠ¤ë ˆë“œ/ìš”ì²­ ë‹¨ìœ„ë¡œ ì»¨í…ìŠ¤íŠ¸ë¥¼ í•œ ë²ˆ ì„¤ì •í•˜ë©´, ê·¸ ìŠ¤ë ˆë“œ ì•ˆì˜ ëª¨ë“  ë¡œê·¸ì— ìë™ìœ¼ë¡œ í¬í•¨**ëœë‹¤.

```
ìš”ì²­ ë“¤ì–´ì˜´
    â”‚
    â–¼
MDC.put("request_id", "req-abc123")
MDC.put("user_id", "U-456")
    â”‚
    â”œâ”€â”€ logger.info("Processing order")     â†â”
    â”‚       â””â”€â”€ ìë™ìœ¼ë¡œ request_id + user_id í¬í•¨  â”‚
    â”‚                                              â”‚
    â”œâ”€â”€ validate()                                 â”‚ MDC ë²”ìœ„
    â”‚   â””â”€â”€ logger.info("Validated")        â†â”¤
    â”‚       â””â”€â”€ ìë™ìœ¼ë¡œ request_id + user_id í¬í•¨  â”‚
    â”‚                                              â”‚
    â”œâ”€â”€ charge()                                   â”‚
    â”‚   â””â”€â”€ logger.info("Charged")          â†â”˜
    â”‚       â””â”€â”€ ìë™ìœ¼ë¡œ request_id + user_id í¬í•¨
    â”‚
    â–¼
MDC.clear()  â† ìš”ì²­ ëë‚˜ë©´ ì •ë¦¬
```

### 6.2 ì–¸ì–´ë³„ êµ¬í˜„

#### Java (SLF4J MDC)

```java
import org.slf4j.MDC;

// ë¯¸ë“¤ì›¨ì–´/í•„í„°ì—ì„œ í•œ ë²ˆ ì„¤ì •
public class RequestFilter implements Filter {
    @Override
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) {
        try {
            MDC.put("request_id", UUID.randomUUID().toString());
            MDC.put("user_id", extractUserId(req));
            MDC.put("client_ip", req.getRemoteAddr());
            
            chain.doFilter(req, res);  // ì´í›„ ëª¨ë“  ë¡œê·¸ì— ìë™ í¬í•¨
        } finally {
            MDC.clear();  // ë°˜ë“œì‹œ ì •ë¦¬ (ìŠ¤ë ˆë“œ í’€ì—ì„œ ëˆ„ì¶œ ë°©ì§€)
        }
    }
}

// ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œì—ì„œëŠ” MDCë¥¼ ì‹ ê²½ ì“¸ í•„ìš” ì—†ìŒ
public class OrderService {
    public void processOrder(Order order) {
        logger.info("Processing order {}", order.getId());
        // ì¶œë ¥: {"message":"Processing order ORD-123","request_id":"req-abc","user_id":"U-456","client_ip":"203.0.113.42"}
    }
}
```

#### Python (structlog)

```python
import structlog
import uuid

# structlog ì´ˆê¸° ì„¤ì •
structlog.configure(
    processors=[
        structlog.processors.TimeStamper(fmt="iso"),
        structlog.processors.add_log_level,
        structlog.processors.JSONRenderer()
    ]
)

# ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ë°”ì¸ë”© (FastAPI ì˜ˆì‹œ)
@app.middleware("http")
async def add_context(request: Request, call_next):
    request_id = str(uuid.uuid4())
    
    # ìš”ì²­ ë²”ìœ„ì˜ ì»¨í…ìŠ¤íŠ¸ ë°”ì¸ë”©
    structlog.contextvars.clear_contextvars()
    structlog.contextvars.bind_contextvars(
        request_id=request_id,
        user_id=get_user_id(request),
        client_ip=request.client.host
    )
    
    response = await call_next(request)
    return response

# ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ â€” ì»¨í…ìŠ¤íŠ¸ê°€ ìë™ìœ¼ë¡œ í¬í•¨ë¨
logger = structlog.get_logger()

async def process_order(order: Order):
    logger.info("processing_order", order_id=order.id)
    # ì¶œë ¥: {"timestamp":"2026-02-24T18:30:00Z","level":"info","event":"processing_order",
    #        "order_id":"ORD-123","request_id":"req-abc","user_id":"U-456","client_ip":"203.0.113.42"}
```

#### Go (slog with context)

```go
// ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ì„¤ì •
func requestMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        logger := slog.With(
            slog.String("request_id", uuid.New().String()),
            slog.String("user_id", getUserID(r)),
            slog.String("client_ip", r.RemoteAddr),
        )
        ctx := context.WithValue(r.Context(), "logger", logger)
        next.ServeHTTP(w, r.WithContext(ctx))
    })
}

// ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œ
func processOrder(ctx context.Context, order Order) {
    logger := ctx.Value("logger").(*slog.Logger)
    logger.Info("processing order", slog.String("order_id", order.ID))
    // ì¶œë ¥: {"time":"2026-02-24T18:30:00Z","level":"INFO","msg":"processing order",
    //        "order_id":"ORD-123","request_id":"req-abc","user_id":"U-456","client_ip":"203.0.113.42"}
}
```

---

## 7. ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œì˜ ë¡œê·¸ ìƒê´€ê´€ê³„

### 7.1 ë¬¸ì œ: í•˜ë‚˜ì˜ ìš”ì²­, ì—¬ëŸ¬ ì„œë¹„ìŠ¤

```
ì‚¬ìš©ìê°€ ì£¼ë¬¸ ë²„íŠ¼ í´ë¦­
    â”‚
    â”œâ”€â”€ API Gateway     (ë¡œê·¸ 10ì¤„)
    â”œâ”€â”€ Auth Service     (ë¡œê·¸ 5ì¤„)
    â”œâ”€â”€ Order Service    (ë¡œê·¸ 20ì¤„)
    â”œâ”€â”€ Payment Service  (ë¡œê·¸ 15ì¤„)
    â”œâ”€â”€ Inventory Service (ë¡œê·¸ 8ì¤„)
    â””â”€â”€ Notification     (ë¡œê·¸ 3ì¤„)

ì´ 61ì¤„ì˜ ë¡œê·¸ê°€ 6ê°œ ì„œë¹„ìŠ¤ì— ë¶„ì‚°
ì´ˆë‹¹ 1000ëª…ì´ ì£¼ë¬¸í•˜ë©´? â†’ 61,000ì¤„/ì´ˆ

ì´ ì¤‘ í•œ ì‚¬ìš©ìì˜ ì£¼ë¬¸ íë¦„ë§Œ ì¶”ì í•˜ë ¤ë©´??
```

### 7.2 í•´ê²°: Correlation ID (ìƒê´€ê´€ê³„ ID)

```
ìš”ì²­ ì§„ì… ì‹œ ê³ ìœ  ID ìƒì„± â†’ ëª¨ë“  ì„œë¹„ìŠ¤ì— ì „íŒŒ â†’ ëª¨ë“  ë¡œê·¸ì— í¬í•¨

  â”Œâ”€ API Gateway â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  request_id = "req-abc"                                        â”‚
  â”‚  trace_id = "trace-xyz"  â† ì´ IDê°€ ëª¨ë“  ì„œë¹„ìŠ¤ì— ì „íŒŒë¨         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ (HTTP Header: X-Trace-Id: trace-xyz)
           â–¼
  â”Œâ”€ Auth Service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  {"trace_id": "trace-xyz", "event": "token_validated"}         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ (Header ì „íŒŒ)
           â–¼
  â”Œâ”€ Order Service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  {"trace_id": "trace-xyz", "event": "order_created"}           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ (Header ì „íŒŒ)
           â–¼
  â”Œâ”€ Payment Service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  {"trace_id": "trace-xyz", "event": "payment_failed"}          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê²€ìƒ‰: trace_id = "trace-xyz"
â†’ 6ê°œ ì„œë¹„ìŠ¤ì˜ 61ì¤„ ì¤‘ ì´ ìš”ì²­ê³¼ ê´€ë ¨ëœ ë¡œê·¸ë§Œ ì¦‰ì‹œ í•„í„°ë§!
```

### 7.3 ID ì „íŒŒ ë°©ë²•

```
HTTP ì„œë¹„ìŠ¤ ê°„:
  â”œâ”€â”€ ìš”ì²­ Headerì— ID í¬í•¨:
  â”‚   X-Request-Id: req-abc-123
  â”‚   traceparent: 00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01
  â”‚   (W3C Trace Context í‘œì¤€)
  â”‚
  â””â”€â”€ ë°›ëŠ” ì„œë¹„ìŠ¤ì—ì„œ ì¶”ì¶œ â†’ MDCì— ì„¤ì • â†’ í•˜ìœ„ í˜¸ì¶œì— ë‹¤ì‹œ ì „íŒŒ

ë©”ì‹œì§€ í (Kafka, RabbitMQ):
  â”œâ”€â”€ ë©”ì‹œì§€ í—¤ë”ì— ID í¬í•¨:
  â”‚   message.headers["trace_id"] = "trace-xyz"
  â”‚
  â””â”€â”€ ì»¨ìŠˆë¨¸ì—ì„œ ì¶”ì¶œ â†’ MDCì— ì„¤ì •

gRPC:
  â””â”€â”€ Metadataì— ID í¬í•¨:
      metadata["trace_id"] = "trace-xyz"
```

---

## 8. êµ¬ì¡°í™” ë¡œê¹… ë„ì… ê°€ì´ë“œ

### 8.1 ê¸°ì¡´ í”„ë¡œì íŠ¸ì— ë„ì…í•˜ëŠ” ë‹¨ê³„

```
Phase 1: ì¶œë ¥ í¬ë§·ë§Œ JSONìœ¼ë¡œ ë°”ê¾¸ê¸° (1ì¼)
  â””â”€ ë¡œê¹… í”„ë ˆì„ì›Œí¬ ì„¤ì •ë§Œ ë³€ê²½
     ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ JSON ì¶œë ¥ ì‹œì‘

Phase 2: í‘œì¤€ í•„ë“œ ì •ì˜ (1ì£¼)
  â””â”€ íŒ€ê³¼ í•©ì˜í•˜ì—¬ í•„ë“œëª…Â·íƒ€ì…Â·í¬ë§· ê²°ì •
     ë¬¸ì„œí™”í•˜ì—¬ ì‹ ê·œ ì„œë¹„ìŠ¤ì— ì ìš©

Phase 3: MDC/ì»¨í…ìŠ¤íŠ¸ ë„ì… (1~2ì£¼)
  â””â”€ ë¯¸ë“¤ì›¨ì–´ì—ì„œ request_id, user_id ìë™ ì£¼ì…
     ëª¨ë“  ë¡œê·¸ì— ì¶”ì  ì •ë³´ í¬í•¨

Phase 4: ì¤‘ì•™ ìˆ˜ì§‘Â·ë¶„ì„ (2~4ì£¼)
  â””â”€ ELK, Loki, Splunk ë“± ë¡œê·¸ ìˆ˜ì§‘ ì¸í”„ë¼ êµ¬ì¶•
     ëŒ€ì‹œë³´ë“œ, ì•Œë¦¼ ì„¤ì •
```

### 8.2 ì²´í¬ë¦¬ìŠ¤íŠ¸

```
â–¡ ëª¨ë“  ë¡œê·¸ê°€ JSON í¬ë§·ì¸ê°€?
â–¡ íƒ€ì„ìŠ¤íƒ¬í”„ì— ì‹œê°„ëŒ€ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€? (ISO 8601)
â–¡ ì„œë¹„ìŠ¤ëª…, í™˜ê²½, ë²„ì „ì´ ëª¨ë“  ë¡œê·¸ì— í¬í•¨ë˜ëŠ”ê°€?
â–¡ ë¶„ì‚° ì¶”ì  ID (trace_id)ê°€ ì„œë¹„ìŠ¤ ê°„ ì „íŒŒë˜ëŠ”ê°€?
â–¡ ë¯¼ê° ì •ë³´ê°€ ë¡œê·¸ì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ê°€?
â–¡ ë¡œê·¸ ë ˆë²¨ì´ ì ì ˆí•˜ê²Œ ì‚¬ìš©ë˜ëŠ”ê°€?
â–¡ ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ë™ì¼í•œ í•„ë“œëª…ì„ ì‚¬ìš©í•˜ëŠ”ê°€?
â–¡ ì—ëŸ¬ ë¡œê·¸ì— ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ê°€ í¬í•¨ë˜ëŠ”ê°€?
â–¡ ë¡œê·¸ê°€ ì¤‘ì•™ ì‹œìŠ¤í…œì— ìˆ˜ì§‘ë˜ëŠ”ê°€?
â–¡ ë¡œê·¸ ê¸°ë°˜ ì•Œë¦¼ì´ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
```

---

## ì •ë¦¬

```
êµ¬ì¡°í™”ëœ ë¡œê¹…:
â”œâ”€â”€ ì •ì˜: ë¡œê·¸ë¥¼ í‚¤-ê°’ ìŒ(JSON)ìœ¼ë¡œ ê¸°ë¡, ê¸°ê³„ê°€ ì²˜ë¦¬í•˜ëŠ” ë°ì´í„°
â”œâ”€â”€ ì§„í™”: ë¹„êµ¬ì¡°í™”(í…ìŠ¤íŠ¸) â†’ ë°˜êµ¬ì¡°í™”(í‚¤=ê°’) â†’ êµ¬ì¡°í™”(JSON)
â”‚
â”œâ”€â”€ 4ëŒ€ ì›ì¹™:
â”‚   â”œâ”€â”€ ì¼ê´€ì„±: ëª¨ë“  ì„œë¹„ìŠ¤ ë™ì¼ í•„ë“œëª…
â”‚   â”œâ”€â”€ í’ë¶€í•œ ì»¨í…ìŠ¤íŠ¸: ë¡œê·¸ í•œ ì¤„ë¡œ ìƒí™© íŒŒì•…
â”‚   â”œâ”€â”€ ë¯¼ê° ì •ë³´ ì œì™¸: ë¹„ë°€ë²ˆí˜¸Â·ì¹´ë“œë²ˆí˜¸ ì ˆëŒ€ ê¸ˆì§€
â”‚   â””â”€â”€ ì´ë²¤íŠ¸ ì¤‘ì‹¬: ì„œìˆ ì´ ì•„ë‹Œ ì‚¬ê±´ ê¸°ë¡
â”‚
â”œâ”€â”€ í‘œì¤€ ìŠ¤í‚¤ë§ˆ:
â”‚   â”œâ”€â”€ ECS (Elastic Common Schema): ELK ìƒíƒœê³„
â”‚   â””â”€â”€ OpenTelemetry: ë²¤ë” ì¤‘ë¦½, íŠ¸ë ˆì´ì‹± ë„¤ì´í‹°ë¸Œ í†µí•©
â”‚
â”œâ”€â”€ ì»¨í…ìŠ¤íŠ¸ ìë™ ì£¼ì… (MDC):
â”‚   â”œâ”€â”€ Java: SLF4J MDC.put() / MDC.clear()
â”‚   â”œâ”€â”€ Python: structlog.contextvars.bind_contextvars()
â”‚   â””â”€â”€ Go: slog.With() + context.Context
â”‚
â””â”€â”€ ë¶„ì‚° ìƒê´€ê´€ê³„:
    â”œâ”€â”€ Correlation IDë¡œ ì„œë¹„ìŠ¤ ê°„ ë¡œê·¸ ì—°ê²°
    â”œâ”€â”€ HTTP Header / ë©”ì‹œì§€ í / gRPC Metadataë¡œ ì „íŒŒ
    â””â”€â”€ W3C Trace Context í‘œì¤€ (traceparent í—¤ë”)
```
