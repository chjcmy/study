# localhost vs 0.0.0.0 vs 127.0.0.1

---

## 개념 정리

```
localhost    = 호스트명 (문자열), /etc/hosts에서 보통 127.0.0.1로 해석
127.0.0.1    = IPv4 루프백 주소, 외부에서 접근 불가 (자기 자신만)
0.0.0.0      = "모든 네트워크 인터페이스"를 의미 (와일드카드)
```

### 네트워크 인터페이스 이해

```
서버 머신의 네트워크 인터페이스:

┌─────────────────────────────────────────┐
│              서버 (Host)                 │
│                                         │
│  lo (루프백)      : 127.0.0.1           │  ← 자기 자신만
│  eth0 (이더넷)    : 10.0.1.5            │  ← LAN 접근
│  docker0 (Docker) : 172.17.0.1          │  ← 컨테이너 네트워크
│                                         │
│  서버가 LISTEN하는 주소에 따라 접근 범위 결정  │
└─────────────────────────────────────────┘

127.0.0.1 에서 LISTEN → lo 인터페이스만 → 외부 접근 불가
0.0.0.0 에서 LISTEN → 모든 인터페이스 → 외부 접근 가능
10.0.1.5 에서 LISTEN → eth0만 → 해당 네트워크에서만 접근
```

---

## 상세 비교

| 주소 | 유형 | 외부 접근 | 사용 시나리오 |
|------|------|----------|-------------|
| `localhost` | 호스트명 | ❌ | 개발/테스트 |
| `127.0.0.1` | IPv4 루프백 | ❌ | 개발/테스트 |
| `::1` | IPv6 루프백 | ❌ | IPv6 환경 개발 |
| `0.0.0.0` | 모든 인터페이스 | ✅ | **Docker, 프로덕션** |
| `특정 IP` | 특정 인터페이스 | 해당 네트워크만 | 보안 제한 환경 |

---

## 실무 적용

### 개발 환경

```bash
# 로컬 개발: localhost만 접근 (안전)
uvicorn app.main:app --host 127.0.0.1 --port 8000

# 접근 가능: http://localhost:8000 ✅
# 접근 불가: http://10.0.1.5:8000 ❌ (같은 네트워크 다른 PC)
```

### Docker 환경

```bash
# ❌ 컨테이너 안에서 127.0.0.1로 바인드하면?
# → 컨테이너 내부에서만 접근 가능, 포트 매핑해도 외부 불가!
docker run -p 8000:8000 my-app
# 컨테이너 내부: uvicorn --host 127.0.0.1 → 외부 접근 안 됨!

# ✅ 0.0.0.0 으로 바인드
docker run -p 8000:8000 my-app
# 컨테이너 내부: uvicorn --host 0.0.0.0 → 외부 접근 OK!
```

### Docker의 네트워크 구조

```
호스트 머신 (10.0.1.5)
│
├── docker0 bridge (172.17.0.1)
│       │
│       ├── 컨테이너 A (172.17.0.2)
│       │   └── uvicorn --host 0.0.0.0:8000
│       │       → 포트 매핑: 호스트 8000 → 컨테이너 8000
│       │
│       └── 컨테이너 B (172.17.0.3)
│           └── 다른 서비스
│
└── 외부에서 10.0.1.5:8000 으로 접근 가능!

핵심: Docker 컨테이너 내부에서 0.0.0.0 바인드 필수
     → 그래야 docker0 브릿지를 통해 호스트에서 접근 가능
```

### Azure Container App

```bash
# Container App은 자동으로 외부 노출 관리
# Dockerfile에서:
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]

# Container App의 Ingress 설정이 외부 트래픽 제어:
#   - External: 인터넷에서 접근 가능
#   - Internal: VNet 내부에서만 접근 가능
#   - Target Port: 8000 (컨테이너가 LISTEN하는 포트)
```

---

## 보안 고려사항

```
개발 환경:
  127.0.0.1 → 외부 접근 차단 → 안전

프로덕션:
  0.0.0.0 → 모든 인터페이스 노출 → 방화벽/NSG 필수!
  
  ✅ Azure: NSG + Container App Ingress로 제어
  ✅ AWS: Security Group으로 제어
  ✅ 온프레미스: iptables/firewall로 제어

주의: 0.0.0.0으로 바인드한다고 자동으로 인터넷 공개는 아님!
     방화벽/라우터가 최종 접근을 제어함
```

---

## 면접 핵심 포인트

```
Q: Docker에서 왜 0.0.0.0으로 바인드해야 하나?
A: 127.0.0.1은 컨테이너 내부 루프백만 바인드.
   외부(호스트)에서 접근하려면 0.0.0.0 (모든 인터페이스)에 바인드 필요.
   docker0 브릿지 네트워크를 통해 트래픽이 전달됨.

Q: localhost와 127.0.0.1의 차이?
A: localhost는 호스트명, /etc/hosts에서 해석됨 (보통 127.0.0.1).
   일부 환경에서 ::1 (IPv6)로 해석될 수 있음.
   127.0.0.1은 명확한 IPv4 루프백 주소.
```
