# 3단계: 보안 아키텍처 및 트러블슈팅

Managed Identity로 전환함으로써 얻은 이점과 향후 시스템 운영 시 참고할 정보를 정리합니다.

## 1. 보안 핵심 가치 🛡️
기존 방식(Secret, OBO)과 비교했을 때 다음과 같은 보안적 진보가 있습니다:

-   **Credential-less**: 코드나 환경 변수에 클라이언트 시크릿(비밀번호)을 저장하지 않습니다. 해킹으로 소스가 유출되어도 인프라 접근 권한은 보호됩니다.
-   **MFA Bypass**: Managed Identity는 '사람'이 아닌 '서버 리소스'의 신원입니다. 따라서 휴대폰 인증(MFA)과 같은 대화형 인증 단계가 없어 자동화 프로세스에 매우 적합합니다.
-   **RBAC 기반 제어**: 관리 ID에 부여된 역할(기여자, 독자 등)을 조정하는 것만으로 시스템의 권한 범위를 즉시 제어할 수 있습니다.

## 2. 주요 트러블슈팅 (Q&A)

### Q: `DefaultAzureCredential`이 토큰을 못 가져와요!
*   **A1**: 터미널에서 `az login`을 했는지 확인하세요.
*   **A2**: `.env`의 `CLIENT_ID`가 아까 만든 관리 ID의 클라이언트 ID와 정확히 일치하는지 확인하세요.
*   **A3**: 관리 ID에 '기여자' 또는 '독자' 권한이 해당 **구독(Subscription)** 범위에 할당되어 있는지 확인하세요.

### Q: 특정 리소스만 접근하게 하고 싶어요. (최소 권한 원칙)
*   **A**: 현재는 구독 전체에 '기여자' 권한을 주었으나, 실제 운영 시에는 특정 리소스 그룹이나 특정 서비스(예: Log Analytics 워크스페이스)에만 더 낮은 권한(예: Log Analytics 독자)을 부여하는 것이 가장 안전합니다.

### Q: 로그에 `AADSTS50076` (MFA 필수) 에러가 계속 나요.
*   **A**: `AUTH_METHOD=managed_identity`로 설정되지 않았거나, 코드가 여전히 MSAL의 OBO 플로우를 타고 있을 확률이 높습니다. `auth_provider.py`의 로직에서 `get_service_token`으로 분기되는지 확인하세요.

---
> [!NOTE]
> 이 문서는 2026-02-23 Managed Identity 전환 프로젝트 완료 시점에 작성되었습니다.
