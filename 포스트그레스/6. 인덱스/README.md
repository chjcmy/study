# 6. 인덱스 (Indexes)
#PostgreSQL/Index

데이터베이스의 성능, 특히 조회(SELECT) 성능을 논할 때 인덱스(Index)는 빼놓을 수 없는 핵심 요소입니다. 인덱스는 대량의 데이터 속에서 원하는 데이터를 훨씬 빠르게 찾을 수 있도록 돕는, 책의 '색인'과 같은 역할을 합니다.

## 6.1. 인덱스의 개념

### 인덱스란?

> [!INFO]
> 인덱스는 특정 열(column)의 데이터와 그 데이터가 저장된 행의 물리적 위치(주소)를 함께 저장하는 별도의 데이터 구조입니다. 인덱스가 없으면 데이터베이스는 특정 값을 찾기 위해 테이블 전체를 처음부터 끝까지 스캔해야 하지만(`Full Table Scan`), 인덱스를 사용하면 훨씬 적은 비용으로 원하는 데이터에 바로 접근할 수 있습니다.

### 장점과 단점

-   **장점**:
    -   `WHERE` 절이나 `JOIN` 조건에 사용되는 열을 인덱싱하면 `SELECT` 쿼리의 속도가 비약적으로 향상됩니다.
    -   `ORDER BY` 절에 사용되는 열을 인덱싱하면 정렬 작업의 부하를 줄일 수 있습니다.
    -   `UNIQUE` 인덱스를 생성하여 데이터의 고유성을 보장할 수 있습니다.

-   **단점**:
    -   `INSERT`, `UPDATE`, `DELETE` 작업 시 테이블의 데이터뿐만 아니라 인덱스도 함께 수정해야 하므로 DML 성능이 저하될 수 있습니다.
    -   인덱스 자체도 디스크 공간을 차지합니다.
    -   무분별하게 생성된 인덱스는 오히려 전체적인 성능을 떨어뜨릴 수 있습니다.

## 6.2. 인덱스 생성 및 활용

### `CREATE INDEX`

`CREATE INDEX` 명령어를 사용하여 인덱스를 생성합니다.

```sql
-- 기본 B-Tree 인덱스 생성
CREATE INDEX idx_employees_name ON employees (name);

-- 여러 열을 묶어 복합 인덱스 생성
CREATE INDEX idx_employees_name_salary ON employees (name, salary);

-- 인덱스 삭제
DROP INDEX idx_employees_name;
```

### `EXPLAIN`

쿼리가 인덱스를 잘 사용하고 있는지 확인하려면 `EXPLAIN` 명령어를 사용합니다. 쿼리 실행 계획을 분석하여 `Index Scan`이 일어나는지, 아니면 `Seq Scan`(Sequential Scan, Full Table Scan)이 일어나는지 등을 확인할 수 있습니다.

```sql
EXPLAIN ANALYZE SELECT * FROM employees WHERE name = 'Alice';
```

## 6.3. PostgreSQL의 주요 인덱스 종류

PostgreSQL은 다양한 쿼리 유형에 최적화된 여러 종류의 인덱스를 제공합니다.

### 1. B-Tree (Balanced-Tree)

-   가장 일반적으로 사용되는 기본 인덱스 타입입니다. (`CREATE INDEX` 시 기본값)
-   데이터가 정렬된 상태로 트리 구조를 이루고 있어, 등호(`=`) 비교뿐만 아니라 `<`, `>`, `BETWEEN` 등 범위 검색에서도 뛰어난 성능을 보입니다.
-   대부분의 일반적인 상황에서 B-Tree 인덱스로 충분합니다.

### 2. Hash

-   오직 등호(`=`) 비교에만 사용 가능하며, 매우 빠른 검색 속도를 보입니다.
-   B-Tree와 달리 범위 검색이나 정렬에는 사용할 수 없습니다.
-   과거에는 안정성 문제로 사용을 권장하지 않았으나, 최신 버전에서는 개선되었습니다.

### 3. GiST (Generalized Search Tree)

-   B-Tree를 더 일반화한 인덱스로, 다양한 종류의 데이터와 쿼리 유형을 처리할 수 있도록 확장 가능하게 설계되었습니다.
-   **주요 사용처**:
    -   **공간 데이터(GIS)**: PostGIS 확장 기능에서 2D, 3D 공간 데이터를 인덱싱하여 "현재 위치에서 1km 반경 내의 장소 찾기"와 같은 쿼리를 효율적으로 처리합니다.
    -   **전문 검색(Full-text Search)**: 텍스트 문서 내의 단어를 검색할 때 사용됩니다.

### 4. GIN (Generalized Inverted Index)

-   하나의 열에 여러 개의 값이 포함된 복합적인 데이터 타입을 인덱싱하는 데 최적화되어 있습니다. (Inverted Index: 역 인덱스)
-   **주요 사용처**:
    -   **JSONB**: JSON 문서 내의 특정 키나 값을 빠르게 찾을 때 사용됩니다. (예: `properties ->> 'os' = 'macOS'`)
    -   **배열(Array)**: 배열 내에 특정 원소가 포함되어 있는지 검색할 때 사용됩니다.
    -   **전문 검색(Full-text Search)**: GiST보다 검색 성능이 더 빠르지만, 인덱스 생성 및 업데이트 속도는 더 느릴 수 있습니다.

> [!TIP] 어떤 인덱스를 선택해야 할까?
> -   **일반적인 경우**: `B-Tree`
> -   **JSONB, 배열, 전문 검색**: `GIN`
> -   **GIS, 복잡한 사용자 정의 타입**: `GiST`
> -   **오직 등호 비교만 필요할 때**: `Hash` (하지만 여전히 `B-Tree`가 대부분의 경우 충분히 빠릅니다.)

---
> [[00. 포스트그레스 목차|⬆️ 목차로 돌아가기]]
> [[5. 데이터 타입/README|⬅️ 이전: 5. 데이터 타입]] | [[7. 트랜잭션과 동시성/README|➡️ 다음: 7. 트랜잭션과 동시성]]